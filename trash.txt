const handleDayPress = async (day) => {
        const selectedDay = day.dateString;
        setSelectedDate(selectedDay);

        if (markedDates[selectedDay]) {
            try {
                const doc = await firebase.firestore().collection('EventDates').doc(selectedDay).get();
                setName(doc.data().name);
                setPhoneNumber(doc.data().phoneNumber);
                navigation.push('HallProfile', {name: doc.data().name, phoneNumber: doc.data().phoneNumber, payment: doc.data().payment})

            } catch (error) {
                console.log('Error fetching event data:', error);
            }
        } else {
            setName('');
            setPhoneNumber('');
        }

        setIsDialogVisible(true);
    };

    const sendMessage = async () => {
        console.log('Sending message to ' + phoneNumber);
        let message = 'ஸ்ரீ பெரியசாமி காமாட்சி அம்மன் திருக்கோவில்,' +

                       '\n\nவணக்கம், '+ name + '!\n\n    உங்கள் நிகழ்வு '+ selectedDate +' அந்த தேதிக்கு முன்பதிவு செய்யப்பட்டுள்ளது '+ '\n    நன்றி. ';
        
                        
        try {
            SmsAndroid.autoSend(
                phoneNumber,
                
                message,

                (fail) => {
                    console.log('Failed with this error: ' + fail);
                },
                (success) => {
                    console.log('SMS sent successfully', success);
                },
            );
    }
    catch (error) {
        console.error("Error sending message:", error);
    }
    };

    const handleDialogSubmit = (inputText) => {
        try {
            setName(inputText);

            const docName = selectedDate;
            firebase.firestore().collection('EventDates').doc(docName).set({
                date: selectedDate,
                name: inputText,
                phoneNumber: phoneNumber,
                payment:payment
            })
            .then(() => {
                console.log('Date stored successfully');
            })
            .catch((error) => {
                console.log('Error storing date:', error);
            });

            const markedDay = { [selectedDate]: { selected: true, marked: true, selectedColor: 'blue' } };
            setMarkedDates(markedDay);

            if (selectedDate && name && phoneNumber) {
                Alert.alert(
                    'Confirmation',
                    'Do you need to send a confirmation message?'+phoneNumber,
                    [
                        {
                            text: 'Yes',
                            onPress: () => {
                                sendMessage();
                                console.log('Confirmation message sent');
                            }
                        },
                        {
                            text: 'No',
                            onPress: () => {
                                console.log('Booking confirmed');
                            }
                        }
                    ]
                );
            }

            setIsDialogVisible(false);
        } catch (error) {
            console.log('An error occurred:', error);
        }
    };